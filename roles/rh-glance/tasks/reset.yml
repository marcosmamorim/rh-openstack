---

- name: stop glance api
  command: systemctl stop {{ glance_api_service }}

- name: stop glance registry
  command: systemctl stop {{ glance_registry_service }}

- name: Removing glance default database
  mysql_db:
    name: "{{ db_glance_name }}"
    state: absent
  when: inventory_hostname == glance_master
  ignore_errors: True

- name: Make sure the glance database is present
  mysql_db:
    name: "{{ db_glance_name }}"
    collation: 'utf8_general_ci'
    encoding: "utf8"
    state: present
  when: inventory_hostname == glance_master
  ignore_errors: True

- name: remove glance configuration
  file: state=absent path=/etc/glance/{{ item }}
  with_items:
    - "glance-registry.conf"
    - "glance-api.conf"

- name: remove glance from pacemaker
  command: pcs resource delete {{ item }}
  with_items:
    - glance-api
    - glance-registry
  when: ansible_hostname == master_server
  ignore_errors: True
