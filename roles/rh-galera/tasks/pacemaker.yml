---
- name: stop mariadb before add to pacemaker
  service: name=mariadb state=stopped enabled=no

- name: Get Current DC
  shell: pcs status cluster | awk '/^ Current DC:/ {print $3}'
  register: pacemaker_dc
  tags:
    - pacemaker
    - pacemaker-galera

- name: create galera cluster resource
  command:
    pcs resource create galera galera enable_creation=true wsrep_cluster_address="gcomm://{{ galera_node_names|join(',')}}" check_passwd="{{ mariadb_root_password }}" meta master-max=3 ordered=true op promote timeout=60s on-fail=block --master
  when: ansible_hostname == pacemaker_dc.stdout
  tags:
    - pacemaker
    - pacemaker-galera

# TODO: Create constraints to galera
